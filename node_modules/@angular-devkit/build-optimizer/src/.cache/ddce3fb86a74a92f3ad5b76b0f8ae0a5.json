{"remainingRequest":"D:\\Desenvolvimento\\OBAADM-WEB\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js??ref--8-1!D:\\Desenvolvimento\\OBAADM-WEB\\node_modules\\html2canvas\\dist\\npm\\ResourceLoader.js","dependencies":[{"path":"D:\\Desenvolvimento\\OBAADM-WEB\\node_modules\\html2canvas\\dist\\npm\\ResourceLoader.js","mtime":1549298997492},{"path":"D:\\Desenvolvimento\\OBAADM-WEB\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1549298993416},{"path":"D:\\Desenvolvimento\\OBAADM-WEB\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js","mtime":1549298984589}],"contextDependencies":[],"result":["'use strict';\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports.ResourceStore = undefined;\r\n\r\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\r\n\r\nvar _Feature = require('./Feature');\r\n\r\nvar _Feature2 = _interopRequireDefault(_Feature);\r\n\r\nvar _Proxy = require('./Proxy');\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nvar ResourceLoader = function () {\r\n    function ResourceLoader(options, logger, window) {\r\n        _classCallCheck(this, ResourceLoader);\r\n\r\n        this.options = options;\r\n        this._window = window;\r\n        this.origin = this.getOrigin(window.location.href);\r\n        this.cache = {};\r\n        this.logger = logger;\r\n        this._index = 0;\r\n    }\r\n\r\n    _createClass(ResourceLoader, [{\r\n        key: 'loadImage',\r\n        value: function loadImage(src) {\r\n            var _this = this;\r\n\r\n            if (this.hasResourceInCache(src)) {\r\n                return src;\r\n            }\r\n            if (isBlobImage(src)) {\r\n                this.cache[src] = _loadImage(src, this.options.imageTimeout || 0);\r\n                return src;\r\n            }\r\n\r\n            if (!isSVG(src) || _Feature2.default.SUPPORT_SVG_DRAWING) {\r\n                if (this.options.allowTaint === true || isInlineImage(src) || this.isSameOrigin(src)) {\r\n                    return this.addImage(src, src, false);\r\n                } else if (!this.isSameOrigin(src)) {\r\n                    if (typeof this.options.proxy === 'string') {\r\n                        this.cache[src] = (0, _Proxy.Proxy)(src, this.options).then(function (src) {\r\n                            return _loadImage(src, _this.options.imageTimeout || 0);\r\n                        });\r\n                        return src;\r\n                    } else if (this.options.useCORS === true && _Feature2.default.SUPPORT_CORS_IMAGES) {\r\n                        return this.addImage(src, src, true);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: 'inlineImage',\r\n        value: function inlineImage(src) {\r\n            var _this2 = this;\r\n\r\n            if (isInlineImage(src)) {\r\n                return _loadImage(src, this.options.imageTimeout || 0);\r\n            }\r\n            if (this.hasResourceInCache(src)) {\r\n                return this.cache[src];\r\n            }\r\n            if (!this.isSameOrigin(src) && typeof this.options.proxy === 'string') {\r\n                return this.cache[src] = (0, _Proxy.Proxy)(src, this.options).then(function (src) {\r\n                    return _loadImage(src, _this2.options.imageTimeout || 0);\r\n                });\r\n            }\r\n\r\n            return this.xhrImage(src);\r\n        }\r\n    }, {\r\n        key: 'xhrImage',\r\n        value: function xhrImage(src) {\r\n            var _this3 = this;\r\n\r\n            this.cache[src] = new Promise(function (resolve, reject) {\r\n                var xhr = new XMLHttpRequest();\r\n                xhr.onreadystatechange = function () {\r\n                    if (xhr.readyState === 4) {\r\n                        if (xhr.status !== 200) {\r\n                            reject('Failed to fetch image ' + src.substring(0, 256) + ' with status code ' + xhr.status);\r\n                        } else {\r\n                            var reader = new FileReader();\r\n                            reader.addEventListener('load', function () {\r\n                                // $FlowFixMe\r\n                                var result = reader.result;\r\n                                resolve(result);\r\n                            }, false);\r\n                            reader.addEventListener('error', function (e) {\r\n                                return reject(e);\r\n                            }, false);\r\n                            reader.readAsDataURL(xhr.response);\r\n                        }\r\n                    }\r\n                };\r\n                xhr.responseType = 'blob';\r\n                if (_this3.options.imageTimeout) {\r\n                    var timeout = _this3.options.imageTimeout;\r\n                    xhr.timeout = timeout;\r\n                    xhr.ontimeout = function () {\r\n                        return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) fetching ' + src.substring(0, 256) : '');\r\n                    };\r\n                }\r\n                xhr.open('GET', src, true);\r\n                xhr.send();\r\n            }).then(function (src) {\r\n                return _loadImage(src, _this3.options.imageTimeout || 0);\r\n            });\r\n\r\n            return this.cache[src];\r\n        }\r\n    }, {\r\n        key: 'loadCanvas',\r\n        value: function loadCanvas(node) {\r\n            var key = String(this._index++);\r\n            this.cache[key] = Promise.resolve(node);\r\n            return key;\r\n        }\r\n    }, {\r\n        key: 'hasResourceInCache',\r\n        value: function hasResourceInCache(key) {\r\n            return typeof this.cache[key] !== 'undefined';\r\n        }\r\n    }, {\r\n        key: 'addImage',\r\n        value: function addImage(key, src, useCORS) {\r\n            var _this4 = this;\r\n\r\n            if (process.env.NODE_ENV !== 'production') {\r\n                this.logger.log('Added image ' + key.substring(0, 256));\r\n            }\r\n\r\n            var imageLoadHandler = function imageLoadHandler(supportsDataImages) {\r\n                return new Promise(function (resolve, reject) {\r\n                    var img = new Image();\r\n                    img.onload = function () {\r\n                        return resolve(img);\r\n                    };\r\n                    //ios safari 10.3 taints canvas with data urls unless crossOrigin is set to anonymous\r\n                    if (!supportsDataImages || useCORS) {\r\n                        img.crossOrigin = 'anonymous';\r\n                    }\r\n\r\n                    img.onerror = reject;\r\n                    img.src = src;\r\n                    if (img.complete === true) {\r\n                        // Inline XML images may fail to parse, throwing an Error later on\r\n                        setTimeout(function () {\r\n                            resolve(img);\r\n                        }, 500);\r\n                    }\r\n                    if (_this4.options.imageTimeout) {\r\n                        var timeout = _this4.options.imageTimeout;\r\n                        setTimeout(function () {\r\n                            return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) fetching ' + src.substring(0, 256) : '');\r\n                        }, timeout);\r\n                    }\r\n                });\r\n            };\r\n\r\n            this.cache[key] = isInlineBase64Image(src) && !isSVG(src) ? // $FlowFixMe\r\n            _Feature2.default.SUPPORT_BASE64_DRAWING(src).then(imageLoadHandler) : imageLoadHandler(true);\r\n            return key;\r\n        }\r\n    }, {\r\n        key: 'isSameOrigin',\r\n        value: function isSameOrigin(url) {\r\n            return this.getOrigin(url) === this.origin;\r\n        }\r\n    }, {\r\n        key: 'getOrigin',\r\n        value: function getOrigin(url) {\r\n            var link = this._link || (this._link = this._window.document.createElement('a'));\r\n            link.href = url;\r\n            link.href = link.href; // IE9, LOL! - http://jsfiddle.net/niklasvh/2e48b/\r\n            return link.protocol + link.hostname + link.port;\r\n        }\r\n    }, {\r\n        key: 'ready',\r\n        value: function ready() {\r\n            var _this5 = this;\r\n\r\n            var keys = Object.keys(this.cache);\r\n            var values = keys.map(function (str) {\r\n                return _this5.cache[str].catch(function (e) {\r\n                    if (process.env.NODE_ENV !== 'production') {\r\n                        _this5.logger.log('Unable to load image', e);\r\n                    }\r\n                    return null;\r\n                });\r\n            });\r\n            return Promise.all(values).then(function (images) {\r\n                if (process.env.NODE_ENV !== 'production') {\r\n                    _this5.logger.log('Finished loading ' + images.length + ' images', images);\r\n                }\r\n                return new ResourceStore(keys, images);\r\n            });\r\n        }\r\n    }]);\r\n\r\n    return ResourceLoader;\r\n}();\r\n\r\nexports.default = ResourceLoader;\r\n\r\nvar ResourceStore = exports.ResourceStore = function () {\r\n    function ResourceStore(keys, resources) {\r\n        _classCallCheck(this, ResourceStore);\r\n\r\n        this._keys = keys;\r\n        this._resources = resources;\r\n    }\r\n\r\n    _createClass(ResourceStore, [{\r\n        key: 'get',\r\n        value: function get(key) {\r\n            var index = this._keys.indexOf(key);\r\n            return index === -1 ? null : this._resources[index];\r\n        }\r\n    }]);\r\n\r\n    return ResourceStore;\r\n}();\r\n\r\nvar INLINE_SVG = /^data:image\\/svg\\+xml/i;\r\nvar INLINE_BASE64 = /^data:image\\/.*;base64,/i;\r\nvar INLINE_IMG = /^data:image\\/.*/i;\r\n\r\nvar isInlineImage = function isInlineImage(src) {\r\n    return INLINE_IMG.test(src);\r\n};\r\nvar isInlineBase64Image = function isInlineBase64Image(src) {\r\n    return INLINE_BASE64.test(src);\r\n};\r\nvar isBlobImage = function isBlobImage(src) {\r\n    return src.substr(0, 4) === 'blob';\r\n};\r\n\r\nvar isSVG = function isSVG(src) {\r\n    return src.substr(-3).toLowerCase() === 'svg' || INLINE_SVG.test(src);\r\n};\r\n\r\nvar _loadImage = function _loadImage(src, timeout) {\r\n    return new Promise(function (resolve, reject) {\r\n        var img = new Image();\r\n        img.onload = function () {\r\n            return resolve(img);\r\n        };\r\n        img.onerror = reject;\r\n        img.src = src;\r\n        if (img.complete === true) {\r\n            // Inline XML images may fail to parse, throwing an Error later on\r\n            setTimeout(function () {\r\n                resolve(img);\r\n            }, 500);\r\n        }\r\n        if (timeout) {\r\n            setTimeout(function () {\r\n                return reject(process.env.NODE_ENV !== 'production' ? 'Timed out (' + timeout + 'ms) loading image' : '');\r\n            }, timeout);\r\n        }\r\n    });\r\n};",null]}